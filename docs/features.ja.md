# 機能仕様書

## 概要

`jsont` は、JSON データを美しく表示する Terminal User Interface (TUI) アプリケーションです。コマンドラインでの JSON 操作を効率的に行うためのツールを提供します。

## コア機能

### 1. JSON 表示機能

#### 基本表示
- **カラフルな構文ハイライト**
  - 文字列: 緑色
  - 数値: シアン色  
  - ブール値: 黄色
  - null: グレー色
  - オブジェクトキー: 青色

- **階層表示**
  - ネストしたオブジェクトと配列の適切なインデント
  - 折りたたみ可能な構造（将来実装予定）

#### 入力方式
- **標準入力 (stdin) からの読み込み**
  ```bash
  cat data.json | jsont
  echo '{"key": "value"}' | jsont
  curl -s https://api.example.com/data | jsont
  ```

- **ファイル入力**（将来実装予定）
  ```bash
  jsont data.json
  jsont *.json
  ```

### 2. 検索・フィルタリング機能

#### ハイブリッドクエリエンジン
- **自動エンジン選択**
  - 複雑なクエリ: jq-web (WebAssembly)
  - シンプルなクエリ: JSONata (JavaScript)
  - 軽量パス: ネイティブ処理

- **統一インターフェース**
  - 単一API で複数エンジン対応
  - 自動フォールバック機能
  - パフォーマンス監視

#### 高度なフィルタリング
- **jq フィルタリング**
  - 完全な jq 構文サポート
  - パイプライン処理
  - 集計・変換機能

- **JSONata クエリ**
  - XPath ライクな構文
  - 直感的なパス表現
  - 条件フィルタリング

#### インテリジェント検索
- **オートコンプリート**
  - データ構造に基づく候補表示
  - 関数名・パス補完
  - 構文ヒント表示

- **リアルタイム検証**
  - 構文エラーの即時表示
  - 修正提案機能
  - パフォーマンス警告

### 3. ナビゲーション機能

#### キーボードショートカット

- **基本操作**
  - `↑/↓`: 上下移動
  - `←/→`: 左右移動（階層の展開/折りたたみ）
  - `Page Up/Down`: ページスクロール
  - `Home/End`: 先頭/末尾への移動

- **特殊操作**
  - `Ctrl+C`: 終了
  - `/`: 検索モード開始
  - `Esc`: モード終了
  - `Tab`: フィルタ入力モード切り替え

#### 強化されたテキスト入力システム（2025年版）

- **統一TextInput アーキテクチャ**
  - 全てのテキスト入力コンポーネントで共通の動作
  - 一貫したキーボードショートカット体験
  - プラットフォーム固有の最適化対応

- **Emacs風キーボードショートカット**
  - **Ctrl+A**: 行の先頭に移動 (Beginning of line)
  - **Ctrl+E**: 行の末尾に移動 (End of line)
  - **Ctrl+F**: カーソルを右に移動 (Forward char)
  - **Ctrl+B**: カーソルを左に移動 (Backward char)
  - **Ctrl+K**: カーソルから行末まで削除 (Kill line)
  - **Ctrl+U**: 行の先頭からカーソルまで削除 (Unix line discard)
  - **Ctrl+W**: 単語を後方削除 (Backward kill word)
  - **Ctrl+D**: カーソル位置の文字を削除 (Delete char)

- **プラットフォーム対応の削除キー動作**
  - **macOS**: Delete キーは Backspace として動作（macOSの標準動作）
  - **Windows/Linux**: Delete キーは前方削除として動作
  - **Backspace**: 全プラットフォームで後方削除

- **高度なテキスト編集機能**
  - **単語境界認識**: Ctrl+W での単語削除でスペースとアルファベットを区別
  - **カーソル位置表示**: アクティブな入力フィールドでの視覚的カーソル
  - **範囲選択**: 矢印キー + Shift での文字列選択（将来実装予定）

#### テキスト入力対応コンポーネント

- **検索バー**: JSON内容の検索・フィルタリング
- **jqクエリ入力**: jq式の入力と編集
- **エクスポートダイアログ**: ファイル名・パス・URL入力
- **設定入力**: 各種設定値の入力（将来実装予定）

#### 入力支援機能

- **オートコンプリート統合**: TextInputシステムとの統合
- **構文ハイライト**: リアルタイムでの入力内容の色分け
- **エラー表示**: 不正な入力の即座の視覚フィードバック
- **履歴機能**: 過去の入力履歴の呼び出し（将来実装予定）

#### 階層ナビゲーション
- **パンくずリスト**
  - 現在位置の表示
  - クリック可能なパス要素

- **ズーム機能**
  - 特定のオブジェクトにフォーカス
  - 親レベルへの復帰

### 4. データ操作機能

#### コピー機能
- **選択した値のコピー**
  - クリップボードへの値コピー
  - JSON パスのコピー
  - 整形されたJSON全体のコピー

#### エクスポート機能
- **各種フォーマットでの出力**
  - 整形されたJSON
  - 圧縮されたJSON
  - CSV形式（配列データの場合）
  - YAML形式

### 5. 表示オプション

#### 高性能レンダリング
- **仮想スクロール**
  - @tanstack/react-virtual による最適化
  - 動的サイズ計算
  - スムーズなスクロール体験

- **段階的ローディング**
  - 大容量JSON の分割読み込み
  - プログレッシブ表示
  - メモリ使用量最適化

#### カスタマイズ可能な表示設定
- **マルチテーマ対応**
  - ダークテーマ（デフォルト）
  - ライトテーマ
  - Nord テーマ
  - Monokai テーマ
  - カスタムテーマ作成

- **表示モード拡張**
  - コンパクトモード
  - 詳細モード
  - プレゼンテーションモード
  - ツリービューモード

#### アクセシビリティ向上
- **フォント設定**
  - サイズ調整
  - ファミリー選択
  - 行間調整

- **カラーバリアフリー**
  - 高コントラストモード
  - カラーブラインド対応
  - パターン表示オプション

## 技術要件

### パフォーマンス目標
- **応答性**: フィルタリング操作が50ms以内で完了
- **メモリ効率**: 200MB以下のJSON を安定して処理
- **起動時間**: 500ms以内での初期表示
- **バンドルサイズ**: 効率的なTree-shaking対応

### 技術スタック要件
- **ハイブリッドクエリ**: jq + JSONata による柔軟なクエリ対応
- **アトミック状態管理**: Jotai による効率的な状態管理
- **仮想スクロール**: @tanstack/react-virtual による大容量データ対応
- **TypeScript**: strict mode完全対応

### 互換性
- **JSON仕様**: RFC 7159 + JSON5 拡張（コメント・末尾カンマ対応）
- **プラットフォーム**: macOS, Linux, Windows（WSL含む）
- **ターミナル**: 256色対応の現代的なターミナル
- **Node.js**: 18.0+ (ES Modules対応)

### セキュリティ
- **入力検証**: 不正なJSONの安全な処理
- **メモリ安全性**: TypeScript strict mode による型安全性
- **プライバシー**: ローカル処理のみ、外部通信なし
- **サンドボックス**: WebAssembly jq実行の分離

## 品質基準

### ユーザビリティ
- **直感的な操作**: 学習コストの最小化
- **高速な操作**: キーボード中心のワークフロー
- **エラー処理**: 分かりやすいエラーメッセージ

### 保守性
- **モジュラー設計**: 機能ごとの独立したコンポーネント
- **テストカバレッジ**: 80%以上のコードカバレッジ
- **ドキュメント**: 包括的な開発者ドキュメント